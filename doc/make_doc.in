#!/usr/bin/env bash
# The file make_doc is generated from make_doc.in
set -e
set -o pipefail

if [ $# != 2 -a $# != 3 ]; then
    echo "usage: make_doc <books> <nopdf> [<runs>]"
    exit 1
fi

GAP=@abs_top_builddir@/bin/gap.sh
GAPARGS="-b -m 1g -x 80 -q -r -A --quitonbreak"
GAPARGS+=' -c base:="@abs_top_srcdir@";'
GAPARGS+=' -c books:="'${1}'";'
if [ "$2" == "withpdf" ]; then
    GAPARGS+=' -c createPDF:=true;'
elif [ "$2" == "nopdf" ]; then
    GAPARGS+=' -c createPDF:=false;'
else
    echo '<nopdf> must be either the string "withpdf" or "nopdf"'
    exit 1
fi
if [ "$#" == 3 ]; then
    if [ "$3" != 1 -a "$3" != 2 ]; then
        echo "<runs> must be 1 or 2"
        exit 1
    fi
    GAPARGS+=' -c runs:='$3';'
else
    GAPARGS+=' -c runs:=2;'
fi

"${GAP}" ${GAPARGS} @abs_top_srcdir@/doc/make_doc.g
