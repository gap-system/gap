#!/bin/sh
#############################################################################
##
## $Id$

if [ ${DISTROOT}X==X ]; then
  echo 'Loading environment settings'
  source ./setvar
fi

line='cd '${DISTROOT}
echo $line
$line 

if [ \! -f tomlib${TOMLIBVER}.zoo ];  then
  echo "Fetching tomlib${TOMLIBVER}.zoo from web page"
  wget http://www.math.rwth-aachen.de/~Thomas.Breuer/tomlib/tomlib${TOMLIBVER}.zoo
fi

if [ \! -f tomlibxt${TOMLIBVER}.zoo ];  then
  echo "Fetching tomlibxt${TOMLIBVER}.zoo from web page"
  wget http://www.math.rwth-aachen.de/~Thomas.Breuer/tomlib/tomlibxt${TOMLIBVER}.zoo
fi

echo "Merging file "${DISTROOT}"/tomlib${TOMLIBVER}.zoo into "
echo "main archive."
cd ${DISTNAME}/pkg
rm -rf tomlib
unzoo -x ${DISTROOT}/tomlib${TOMLIBVER}.zoo
cd ${DISTROOT}
# they are all textfiles
zooarchive=${ARCHNAME}.zoo
find \
   ${DISTNAME}/pkg/tomlib \
       -type f -exec sh -c \
       '(echo "!TEXT!"; echo "/end") |  zoo ahc '${zooarchive}' '{} ";"
             
echo "Repacking tomlibxt${TOMLIBVER}.zoo to xtom${TOMLIBVER}.zoo by prepending paths."
cd ${DISTNAME}/pkg
rm -rf tomlib
unzoo -x ${DISTROOT}/tomlibxt${TOMLIBVER}.zoo
cd ${DISTROOT}
find \
   ${DISTNAME}/pkg/tomlib \
       -type f -exec sh -c \
       '(echo "!TEXT!"; echo "/end") |  zoo ahc xtom${TOMLIBVER}.zoo '{} ";"


exit 0

